---
title: ä» 0 åˆ° 1 å®ç° Reactï¼ˆä¸€ï¼‰å®ç° createElement æ–¹æ³•
date: 2022-02-04 08:00:59
tags: 
  - react
  - ä» 0 åˆ° 1 ç³»åˆ—
categories: react
---
---
theme: devui-blue
---

## æ¦‚è¦

- æœ¬æ–‡æ˜¯ä½œè€…åœ¨è¯»æ‡‚äº†å¤§ç¥`Rodrigo Pombo` çš„[ã€ŠBuild your own Reactã€‹](https://pomb.us/build-your-own-react/)æºç åï¼ŒåŠ ä¸Šäº†è‡ªå·±çš„ç†è§£ï¼Œä»¥åŠåšäº†å°‘é‡ä¿®æ”¹åçš„å®ç°ï¼Œåœ¨è¿™é‡Œå†æ¬¡æ„Ÿè°¢å¤§ç¥ï¼ğŸ™ğŸ»
- æ ¸å¿ƒä»£ç  200+ ğŸ‰
- fiber æ¶æ„çš„ react ğŸ”¥
- é€šä¿—æ˜“æ‡‚ï¼Œå¯¹æ ‡å…¨ç½‘æœ€ç®€å•çš„ react å®ç° ğŸ˜
- æ„å»ºå·¥å…·é€‰ç”¨ parcelï¼Œå·ç§°é›¶é…ç½®
- ä»é›¶åˆ°ä¸€çš„å®ç°ä¸€ä¸ª react
- æ¯ç¯‡æ–‡ç« åœ¨æœ€åï¼Œéƒ½ä¼šé™„ä¸Šå½“å‰ç« èŠ‚æºç  ğŸŒ
- [github æºç ](https://github.com/chao31/Didact)


## åˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®

åˆ›å»ºé¡¹ç›®å¹¶åˆå§‹åŒ–`package.json`

```bash
mkdir Didact
npm init -y 
```

### å®‰è£… parcel

```js
npm i -D parcel-bundler@^1.12.5
```
**ä¸ºäº†è·Ÿç€æ•™ç¨‹èµ°ä¸ä¼šå› ç‰ˆæœ¬é—®é¢˜æŠ¥é”™ï¼Œæœ¬æ–‡æ¥ä¸‹æ¥çš„æ‰€æœ‰ npm ä¾èµ–éƒ½å°†å¸¦ä¸Šç‰ˆæœ¬å·**

### æ–°å¢ index.html æ¨¡æ¿

æ·»åŠ  html ä»£ç ï¼š

-   æ ¹èŠ‚ç‚¹Â `root`
-   å†…è”çš„æ–¹å¼å¼•å…¥ ä¸€ä¸ª`index.js`

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <title>Didact</title>
  </head>
  <body>
    <div id="root"></div>
  </body>
  <script src="./index.js"></script>
</html>
```

### æ·»åŠ å…¥å£ index.js

`index.js`é‡Œé¢æ˜¯ä¸€æ®µ JSX ä»£ç 

 ```js
console.log('æˆåŠŸå¯åŠ¨'); 
``` 

### å¢åŠ  script å‘½ä»¤

ä¿®æ”¹ package.json

```diff
"scripts": {
+  "start": "parcel index.html",
},
```
æ‰§è¡ŒÂ `npm start`ï¼Œè®¿é—®`http://localhost:1234/`, ä¼šçœ‹åˆ°æ§åˆ¶å°æ‰“å°`"æˆåŠŸå¯åŠ¨" `

## å¦‚ä½•å¤„ç† JSX

### ä»€ä¹ˆæ˜¯ jsxï¼Ÿ

å¦‚ä¸‹å°±æ˜¯ä¸€æ®µ JSX ä»£ç ï¼ŒÂ [å…·ä½“è¯·å‚è€ƒ](https://zh-hans.reactjs.org/docs/introducing-jsx.html)

```js
const profile = (
  <div className="profile">
    <span className="profile-title">title</span>
    <h3 className="profile-content">content</h3>
    æˆ‘æ˜¯ä¸€æ®µæ–‡æœ¬
  </div>
);
```

æ¥ä¸‹æ¥è¦å°†ä¸Šé¢ `JSX` ä»£ç è½¬åŒ–ä¸ºä¸‹é¢çš„`æ•°æ®ç»“æ„`æ¥æè¿°

```js
// å¯¹è±¡æ¥æè¿° jsx
const profile = {
    type:Â "div",
    props: {
       className:Â "profile",
       children:Â [
           {type:Â 'span',Â props:Â {â€¦}},
           {type:Â 'h3',Â props:Â {â€¦}},
           "æˆ‘æ˜¯ä¸€æ®µæ–‡æœ¬"
       ],
   },
}
```

### å®‰è£… babel å¤„ç† JSX

æˆ‘ä»¬ä½¿ç”¨`@babel/preset-react`æ¥è½¬åŒ– jsxï¼Œä½†åŒæ—¶éœ€å®‰è£…å®ƒæ‰€éœ€è¦ä¾èµ–â€”â€”`babel-core`ï¼Œæ‰€ä»¥æ•´ä½“å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š

```js
npm i -D @babel/preset-react@^7.17.12 babel-core@^7.0.0-bridge.0
```

ç„¶åå†æ ¹ç›®å½•æ·»åŠ `.babelrc`æ–‡ä»¶ï¼š

```json
{
  "presets": [
    [
      "@babel/preset-react",
      {
        // è¿™æ ·å†™ï¼Œbabelä¼šè°ƒç”¨ Didact.createElementå‡½æ•° æ¥é€’å½’ç”Ÿæˆ jsxå¯¹è±¡
        "pragma": "Didact.createElement"
      }
    ]
  ]
}
```

*æ³¨æ„ï¼šæˆ‘ä»¬åœ¨ä¸Šé¢è®¾ç½®äº†`pragma`å±æ€§ï¼Œå®ƒæŒ‡å®šäº†`babel`é€šè¿‡è°ƒç”¨`Didact.createElement`æ¥é€’å½’JSXï¼Œä»è€Œç”Ÿæˆä¸Šé¢çš„æ•°æ®ç»“æ„ã€‚*

### æµ‹è¯• JSX çš„è½¬æ¢

å°† index.js çš„consoleæ‰“å°æ”¹ä¸ºä¸Šé¢çš„é‚£æ®µ JSX

```diff
- console.log('æˆåŠŸå¯åŠ¨');

+ const profile = (
+   <div className="profile">
+     <span className="profile-title">title</span>
+     <h3 className="profile-content">content</h3>
+     æˆ‘æ˜¯ä¸€æ®µæ–‡æœ¬
+   </div>
+ );

+ console.log('profile: ', profile);
```

æ‰“å¼€æ§åˆ¶å°ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯æç¤ºï¼š

```js
Uncaught ReferenceError: Didact is not defined
    at Object.parcelRequire.index.js (index.js:29:3)
    at newRequire (Didact.e31bb0bc.js:47:24)
    at Didact.e31bb0bc.js:81:7
    at Didact.e31bb0bc.js:120:3
```

ç‚¹å‡»è¿›å…¥ç¬¬ä¸€è¡Œé”™è¯¯å®šä½ï¼Œä¼šè·³è½¬åˆ°æºç å‡ºé”™çš„åœ°æ–¹â€”â€” â€œDidact.createElement æœªå®šä¹‰â€ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æœªå®ç°`Didact.createElement`,æ‰€ä»¥å› æ‰¾ä¸åˆ°è¯¥å‡½æ•°è€ŒæŠ¥é”™ã€‚

ä½†åœ¨å®ç°`createElement`æ–¹æ³•å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹babelæ˜¯å¦‚ä½•å¤„ç†jsxçš„ã€‚

### babelè½¬æ¢jsxçš„è¿‡ç¨‹
babelè°ƒç”¨`Didact.createElement`è½¬æ¢jsxçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

```js
var profile = Didact.createElement(
  // HTML æ ‡ç­¾çš„ç±»å‹
  "div", 
  // è¯¥ HTML æ ‡ç­¾çš„å±æ€§
  { className: "profile" }, 
  // åé¢éƒ½è¯¥ HTML æ ‡ç­¾çš„ children
  // ç¬¬ä¸€ä¸ª child
  Didact.createElement(
    "span", 
    { className: "profile-title" }, 
    "title"
  ), 
  // ç¬¬äºŒä¸ª child
  Didact.createElement(
    "h3", 
    { className: "profile-content" }, 
    "content"
  ),
  // ç¬¬ä¸‰ä¸ª child
  "æˆ‘æ˜¯ä¸€æ®µæ–‡æœ¬"
);

console.log('profile: ', profile);
// ...
```

ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œ`@babel/preset-react`åšäº†ä¸¤ä»¶äº‹æƒ…ï¼š

-   å°† JSX ä»£ç è½¬æ¢æˆäº†å‚æ•°ï¼Œ`type, props, ...children`
-   å°†ä¸Šé¢çš„å‚æ•°ä¼ é€’ç»™ Didact.createElementï¼Œå¹¶æ‰§è¡Œè¯¥å‡½æ•°

```js
Didact.createElement(
  type,
  [props],
  [...children]
)

// å‚æ•°è¯´æ˜ï¼š

// - typeï¼šæ ‡ç­¾ç±»å‹ï¼Œå¦‚ï¼š`div`ã€`span`ã€`h3`, 
//        ä¹Ÿå¯ä»¥æ˜¯ React ç»„ä»¶ ç±»å‹ï¼ˆclass ç»„ä»¶æˆ–å‡½æ•°ç»„ä»¶ï¼‰
// - props: è¯¥æ ‡ç­¾çš„å±æ€§ï¼Œå¦‚`classname`, è‹¥æ— åˆ™ä¸º null
// - childrenï¼šç¬¬ 2ã€3...ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯å­å…ƒç´ ï¼Œå­å…ƒç´ åˆå¼€å§‹é€’å½’è°ƒç”¨`React.createElement`
```

## å®ç° createElement æ–¹æ³•

å¾ˆç®€å•ï¼Œè®©`Didact.createElement`Â è¿”å›ä¸€ä¸ªå«æœ‰ children çš„æ ‘çŠ¶ç»“æ„ï¼Œå°±å®ç°äº†createElement

åœ¨index.jsä¸­æ·»åŠ ï¼š

```diff
+ function createElement(type, props, ...children) {
+   return {
+     type,
+     props: {
+       ...props,
+       ...children,
+     }
+   };
+ }

+ const Didact = {
+   createElement,
+ };

const profile = (
  <div className="profile">
    <span className="profile-title">title</span>
    <h3 className="profile-content">content</h3>
    æˆ‘æ˜¯ä¸€æ®µæ–‡æœ¬
  </div>
);

console.log('profile: ', profile);
```

è¿™æ ·å°±å®ç°äº†`createElement`æ–¹æ³•ã€‚

ä½†é€šè¿‡consoleæ‰“å°å‘ç°ï¼Œ`children`ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œé™¤äº†`æ–‡æœ¬èŠ‚ç‚¹`æ˜¯`string`å…¶å®ƒèŠ‚ç‚¹éƒ½æ˜¯`å¯¹è±¡`ã€‚

è¿™é‡Œå°†æ–‡æœ¬èŠ‚ç‚¹ä¹Ÿç»Ÿä¸€å¤„ç†æˆå¯¹è±¡ï¼Œè¿™æ ·åé¢ä¼šå°‘äº†å¾ˆå¤š`ifã€else`çš„åˆ¤æ–­ã€‚

å°†æ–‡æœ¬èŠ‚ç‚¹æ„å»ºä¸º`typeï¼š'TEXT_ELEMENT'`çš„å¯¹è±¡ï¼Œä¿®æ”¹ä»£ç ï¼š

```diff
function createElement(type, props, ...children) {
  return {
    type,
    props: {
      ...props,
-      ...children,
+      children: children.map(child =>
+        typeof child === "object" ? child : createTextElement(child)
+      )
    }
  };
}

+ function createTextElement(text) {
+  return {
+    type: "TEXT_ELEMENT",
+    props: {
+      nodeValue: text,
+      children: []
+    }
+  };
+ }

const Didact = {
  createElement,
};

```

è¿™æ ·æˆ‘ä»¬å°±å½»åº•å®Œæˆäº†`createElement`æ–¹æ³•

[æœ¬ç« æºç ](https://github.com/chao31/Didact/blob/feature/chao31_createElement/index.js)

